var akra={parser:{}};akra.parser.ENodeCreateMode={k_Default:0,k_Necessary:1,k_Not:2};akra.parser.EParserCode={k_Pause:0,k_Ok:1,k_Error:2};akra.parser.EParserType={k_LR0:0,k_LR1:1,k_LALR:2};akra.parser.EParseMode={k_AllNode:1,k_Negate:2,k_Add:4,k_Optimize:8,k_DebugMode:16};akra.parser.ETokenType={k_NumericLiteral:1,k_CommentLiteral:2,k_StringLiteral:3,k_PunctuatorLiteral:4,k_WhitespaceLiteral:5,k_IdentifierLiteral:6,k_KeywordLiteral:7,k_Unknown:8,k_End:9};akra.parser.IToken=function(){};
akra.parser.IRule=function(){};akra.parser.EOperationType={k_Error:100,k_Shift:101,k_Reduce:102,k_Success:103,k_Pause:104,k_Ok:105};akra.parser.IParseNode=function(){};akra.parser.IParseTree=function(){};akra.parser.ILexer=function(){};akra.parser.IParserState=function(){};akra.parser.IParser=function(){};akra.bf={};akra.bf.flag=function(a){return 1<<a};akra.bf.testBit=function(a,b){return 0!=(a&akra.bf.flag(b))};akra.bf.testAll=function(a,b){return(a&b)==b};
akra.bf.testAny=function(a,b){return 0!=(a&b)};akra.bf.setBit=function(a,b,c){"undefined"===typeof c&&(c=!0);return c?a|akra.bf.flag(b):akra.bf.clearBit(a,b)};akra.bf.clearBit=function(a,b){return a&~akra.bf.flag(b)};akra.bf.setAll=function(a,b,c){"undefined"===typeof c&&(c=!0);return c?a|b:a&~b};akra.bf.clearAll=function(a,b){return a&~b};akra.bf.equal=function(a,b){};akra.bf.isEqual=function(a,b){return a==b};akra.bf.isNotEqaul=function(a,b){return a!=b};akra.bf.set=function(a,b){};
akra.bf.clear=function(a){};akra.bf.setFlags=function(a,b){return a|b};akra.bf.clearFlags=function(a,b){return a&~b};akra.bf.isEmpty=function(a){return 0==a};akra.bf.totalBits=function(a){return 32};akra.bf.totalSet=function(a){for(var b=0,c=akra.bf.totalBits(a);c;--c)b+=a&1,a>>=1;return b};akra.bf.fixedToFixed=function(a,b,c){b>c?a>>=b-c:b<c&&(a=0==a?0:a==(1<<b)-1?(1<<c)-1:a*(1<<c)/((1<<b)-1));return a};akra.bf.floatToFixed=function(a,b){return 0>=a?0:1<=a?(1<<b)-1:a*(1<<b)};
akra.bf.fixedToFloat=function(a,b){return(a&(1<<b)-1)/((1<<b)-1)};akra.bf.intWrite=function(a,b,c){switch(b){case 1:a[0]=c;break;case 2:a[1]=c>>8&255;a[0]=c&255;break;case 3:a[2]=c>>16&255;a[1]=c>>8&255;a[0]=c&255;break;case 4:a[3]=c>>24&255,a[2]=c>>16&255,a[1]=c>>8&255,a[0]=c&255}};akra.bf.intRead=function(a,b){switch(b){case 1:return a[0];case 2:return a[0]|a[1]<<8;case 3:return a[0]|a[1]<<8|a[2]<<16;case 4:return a[0]|a[1]<<8|a[2]<<16|a[3]<<24}return 0};akra.bf._u32=new Uint32Array(1);
akra.bf._f32=new Float32Array(akra.bf._u32.buffer);akra.bf.floatToHalf=function(a){akra.bf._f32[0]=a;return akra.bf.floatToHalfI(akra.bf._u32[0])};akra.bf.floatToHalfI=function(a){var b=a>>16&32768,c=(a>>23&255)-112;a&=8388607;if(0>=c)return-10>c?0:b|(a|8388608)>>1-c>>13;if(143==c){if(0==a)return b|31744;a>>=13;return b|31744|a|0==a}return 30<c?b|31744:b|c<<10|a>>13};akra.bf.halfToFloat=function(a){akra.bf._u32[0]=akra.bf.halfToFloatI(a);return akra.bf._f32[0]};
akra.bf.halfToFloatI=function(a){var b=a>>15&1,c=a>>10&31;a&=1023;if(0==c){if(0==a)return b<<31;for(;!(a&1024);)a<<=1,c-=1;c+=1;a&=-1025}else if(31==c)return 0==a?b<<31|2139095040:b<<31|2139095040|a<<13;return b<<31|c+112<<23|a<<13};akra.IConvertionTableRow=function(){};akra.EDataTypes={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126};
akra.EDataTypeSizes={BYTES_PER_BYTE:1,BYTES_PER_UNSIGNED_BYTE:1,BYTES_PER_UBYTE:1,BYTES_PER_SHORT:2,BYTES_PER_UNSIGNED_SHORT:2,BYTES_PER_USHORT:2,BYTES_PER_INT:4,BYTES_PER_UNSIGNED_INT:4,BYTES_PER_UINT:4,BYTES_PER_FLOAT:4};akra.conv={};akra.conv.parseBool=function(a){return"true"===a};akra.conv.parseString=function(a){return String(a)};akra.conv.parseJSON=function(a){return eval("("+a+")")};akra.conv.parseHTML=function(a){var b=document.createElement("div");b.innerHTML=a;return b.childNodes};
akra.conv.parseHTMLDocument=function(a){var b=akra.conv.parseHTML(a);a=document.createDocumentFragment();for(var c=0,d=b.length;c<d;++c)akra.isDef(b[c])&&a.appendChild(b[c]);return a};akra.conv.retrieve=function(a,b,c,d,e,f,g){akra.isDef(e)||(e=a.length/c-d);f+g>c&&(g=c-f);d*=c;for(var k=0,m=0;m<e;++m)for(var n=0;n<g;++n)b[k++]=a[d+m*c+f+n];return k};akra.conv.string2Array=function(a,b,c,d){a=a.split(/[\s]+/g);for(var e=0,f=a.length,g=0;e<f;++e)""!=a[e]&&(b[d+g]=c(a[e]),g++);return g};
akra.conv.stoia=function(a,b,c){return akra.conv.string2Array(a,b,parseInt,c)};akra.conv.stofa=function(a,b,c){return akra.conv.string2Array(a,b,parseFloat,c)};akra.conv.stoba=function(a,b,c){return akra.conv.string2Array(a,b,akra.conv.parseBool,c)};akra.conv.stosa=function(a,b,c){return akra.conv.string2Array(a,b,akra.conv.parseString,c)};akra.conv.stoa=function(a,b,c,d){c=akra.conv.conversionFormats[c];var e=new c.type(b);c.converter(a,e);return 1!=b||d?e:e[0]};
akra.conv.conversionFormats={"int":{type:Int32Array,converter:akra.conv.stoia},"float":{type:Float32Array,converter:akra.conv.stofa},"boolean":{type:Array,converter:akra.conv.stoba},string:{type:Array,converter:akra.conv.stosa}};akra.conv.stoab=function(a){for(var b=a.length,c=new Uint8Array(b),d=0;d<b;++d)c[d]=a.charCodeAt(d);return c.buffer};akra.conv.abtos=function(a){a=new Uint8Array(a);for(var b="",c=0;c<a.length;++c)b+=String.fromCharCode(a[c]);return b};
akra.conv.abtosAsync=function(a,b){var c=new Blob([a]),d=new FileReader;d.onload=function(a){b(a.target.result)};d.readAsText(c)};akra.conv.abtota=function(a,b){switch(b){case akra.EDataTypes.FLOAT:return new Float32Array(a);case akra.EDataTypes.SHORT:return new Int16Array(a);case akra.EDataTypes.UNSIGNED_SHORT:return new Uint16Array(a);case akra.EDataTypes.INT:return new Int32Array(a);case akra.EDataTypes.UNSIGNED_INT:return new Uint32Array(a);case akra.EDataTypes.BYTE:return new Int8Array(a);default:case akra.EDataTypes.UNSIGNED_BYTE:return new Uint8Array(a)}};
akra.conv.btoaAsync=function(a,b){var c=new FileReader;c.onload=function(a){b(null,a.target.result)};c.onerror=function(a){b(a,null)};c.readAsArrayBuffer(a)};akra.conv.dutobAsync=function(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0);c.responseType="blob";c.onload=function(a){200==this.status&&b(this.response)};c.send()};
akra.conv.dutojAsync=function(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0);c.overrideMimeType("application/json");c.responseType="json";c.onload=function(a){200==this.status&&b(this.response)};c.send()};akra.conv.dutob=function(a){var b=atob(a.split(",")[1]);a=a.split(",")[0].split(":")[1].split(";")[0];for(var c=new ArrayBuffer(b.length),d=new Uint8Array(c),e=0;e<b.length;e++)d[e]=b.charCodeAt(e);return new Blob([c],{type:a})};
akra.conv.toURL=function(a,b){"undefined"===typeof b&&(b="text/plain");var c;try{c=new Blob([a],{type:b})}catch(d){c=new BlobBuilder,c.append(a),c=c.getBlob(b)}return URL.createObjectURL(c)};akra.conv.utf8tob64=function(a){return window.btoa(unescape(encodeURIComponent(a)))};
akra.conv.toUTF8=function(a){if(null===a||"undefined"===typeof a)return"";a+="";var b="",c,d,e=0;c=d=0;for(var e=a.length,f=0;f<e;f++){var g=a.charCodeAt(f),k=null;128>g?d++:k=127<g&&2048>g?String.fromCharCode(g>>6|192)+String.fromCharCode(g&63|128):String.fromCharCode(g>>12|224)+String.fromCharCode(g>>6&63|128)+String.fromCharCode(g&63|128);null!==k&&(d>c&&(b+=a.slice(c,d)),b+=k,c=d=f+1)}d>c&&(b+=a.slice(c,e));return b};
akra.conv.fromUTF8=function(a){var b=[],c=0,d=0,e=0,f=0,g=0;for(a+="";c<a.length;)e=a.charCodeAt(c),128>e?(b[d++]=String.fromCharCode(e),c++):191<e&&224>e?(f=a.charCodeAt(c+1),b[d++]=String.fromCharCode((e&31)<<6|f&63),c+=2):(f=a.charCodeAt(c+1),g=a.charCodeAt(c+2),b[d++]=String.fromCharCode((e&15)<<12|(f&63)<<6|g&63),c+=3);return b.join("")};akra.crypto={};
akra.crypto.sha1=function(a){var b=function(a,b){return a<<b|a>>>32-b},c=function(a){var b="",c,d;for(c=7;0<=c;c--)d=a>>>4*c&15,b+=d.toString(16);return b},d,e,f=Array(80),g=1732584193,k=4023233417,m=2562383102,n=271733878,p=3285377520,h,l,q,r,s;a=akra.conv.toUTF8(a);h=a.length;var t=[];for(d=0;d<h-3;d+=4)e=a.charCodeAt(d)<<24|a.charCodeAt(d+1)<<16|a.charCodeAt(d+2)<<8|a.charCodeAt(d+3),t.push(e);switch(h%4){case 0:d=2147483648;break;case 1:d=a.charCodeAt(h-1)<<24|8388608;break;case 2:d=a.charCodeAt(h-
2)<<24|a.charCodeAt(h-1)<<16|32768;break;case 3:d=a.charCodeAt(h-3)<<24|a.charCodeAt(h-2)<<16|a.charCodeAt(h-1)<<8|128}for(t.push(d);14!=t.length%16;)t.push(0);t.push(h>>>29);t.push(h<<3&4294967295);for(a=0;a<t.length;a+=16){for(d=0;16>d;d++)f[d]=t[a+d];for(d=16;79>=d;d++)f[d]=b(f[d-3]^f[d-8]^f[d-14]^f[d-16],1);e=g;h=k;l=m;q=n;r=p;for(d=0;19>=d;d++)s=b(e,5)+(h&l|~h&q)+r+f[d]+1518500249&4294967295,r=q,q=l,l=b(h,30),h=e,e=s;for(d=20;39>=d;d++)s=b(e,5)+(h^l^q)+r+f[d]+1859775393&4294967295,r=q,q=l,l=
b(h,30),h=e,e=s;for(d=40;59>=d;d++)s=b(e,5)+(h&l|h&q|l&q)+r+f[d]+2400959708&4294967295,r=q,q=l,l=b(h,30),h=e,e=s;for(d=60;79>=d;d++)s=b(e,5)+(h^l^q)+r+f[d]+3395469782&4294967295,r=q,q=l,l=b(h,30),h=e,e=s;g=g+e&4294967295;k=k+h&4294967295;m=m+l&4294967295;n=n+q&4294967295;p=p+r&4294967295}s=c(g)+c(k)+c(m)+c(n)+c(p);return s.toLowerCase()};
akra.crypto.md5=function(a){var b,c,d,e,f=function(a,b){var c,d,e,f,g;e=a&2147483648;f=b&2147483648;c=a&1073741824;d=b&1073741824;g=(a&1073741823)+(b&1073741823);return c&d?g^2147483648^e^f:c|d?g&1073741824?g^3221225472^e^f:g^1073741824^e^f:g^e^f},g=function(a,b,c,d,e,g,h){a=f(a,f(f(b&c|~b&d,e),h));return f(a<<g|a>>>32-g,b)},k=function(a,b,c,d,e,g,h){a=f(a,f(f(b&d|c&~d,e),h));return f(a<<g|a>>>32-g,b)},m=function(a,b,c,d,e,g,h){a=f(a,f(f(b^c^d,e),h));return f(a<<g|a>>>32-g,b)},n=function(a,b,c,d,
e,g,h){a=f(a,f(f(c^(b|~d),e),h));return f(a<<g|a>>>32-g,b)},p=function(a){var b="",c="",d;for(d=0;3>=d;d++)c=a>>>8*d&255,c="0"+c.toString(16),b+=c.substr(c.length-2,2);return b},h=[],l,q,r,s,t;a=akra.conv.toUTF8(a);h=function(a){var b,c=a.length;b=c+8;for(var d=16*((b-b%64)/64+1),e=Array(d-1),f=0,g=0;g<c;)b=(g-g%4)/4,f=g%4*8,e[b]|=a.charCodeAt(g)<<f,g++;b=(g-g%4)/4;e[b]|=128<<g%4*8;e[d-2]=c<<3;e[d-1]=c>>>29;return e}(a);b=1732584193;c=4023233417;d=2562383102;e=271733878;a=h.length;for(l=0;l<a;l+=
16)q=b,r=c,s=d,t=e,b=g(b,c,d,e,h[l+0],7,3614090360),e=g(e,b,c,d,h[l+1],12,3905402710),d=g(d,e,b,c,h[l+2],17,606105819),c=g(c,d,e,b,h[l+3],22,3250441966),b=g(b,c,d,e,h[l+4],7,4118548399),e=g(e,b,c,d,h[l+5],12,1200080426),d=g(d,e,b,c,h[l+6],17,2821735955),c=g(c,d,e,b,h[l+7],22,4249261313),b=g(b,c,d,e,h[l+8],7,1770035416),e=g(e,b,c,d,h[l+9],12,2336552879),d=g(d,e,b,c,h[l+10],17,4294925233),c=g(c,d,e,b,h[l+11],22,2304563134),b=g(b,c,d,e,h[l+12],7,1804603682),e=g(e,b,c,d,h[l+13],12,4254626195),d=g(d,e,
b,c,h[l+14],17,2792965006),c=g(c,d,e,b,h[l+15],22,1236535329),b=k(b,c,d,e,h[l+1],5,4129170786),e=k(e,b,c,d,h[l+6],9,3225465664),d=k(d,e,b,c,h[l+11],14,643717713),c=k(c,d,e,b,h[l+0],20,3921069994),b=k(b,c,d,e,h[l+5],5,3593408605),e=k(e,b,c,d,h[l+10],9,38016083),d=k(d,e,b,c,h[l+15],14,3634488961),c=k(c,d,e,b,h[l+4],20,3889429448),b=k(b,c,d,e,h[l+9],5,568446438),e=k(e,b,c,d,h[l+14],9,3275163606),d=k(d,e,b,c,h[l+3],14,4107603335),c=k(c,d,e,b,h[l+8],20,1163531501),b=k(b,c,d,e,h[l+13],5,2850285829),e=k(e,
b,c,d,h[l+2],9,4243563512),d=k(d,e,b,c,h[l+7],14,1735328473),c=k(c,d,e,b,h[l+12],20,2368359562),b=m(b,c,d,e,h[l+5],4,4294588738),e=m(e,b,c,d,h[l+8],11,2272392833),d=m(d,e,b,c,h[l+11],16,1839030562),c=m(c,d,e,b,h[l+14],23,4259657740),b=m(b,c,d,e,h[l+1],4,2763975236),e=m(e,b,c,d,h[l+4],11,1272893353),d=m(d,e,b,c,h[l+7],16,4139469664),c=m(c,d,e,b,h[l+10],23,3200236656),b=m(b,c,d,e,h[l+13],4,681279174),e=m(e,b,c,d,h[l+0],11,3936430074),d=m(d,e,b,c,h[l+3],16,3572445317),c=m(c,d,e,b,h[l+6],23,76029189),
b=m(b,c,d,e,h[l+9],4,3654602809),e=m(e,b,c,d,h[l+12],11,3873151461),d=m(d,e,b,c,h[l+15],16,530742520),c=m(c,d,e,b,h[l+2],23,3299628645),b=n(b,c,d,e,h[l+0],6,4096336452),e=n(e,b,c,d,h[l+7],10,1126891415),d=n(d,e,b,c,h[l+14],15,2878612391),c=n(c,d,e,b,h[l+5],21,4237533241),b=n(b,c,d,e,h[l+12],6,1700485571),e=n(e,b,c,d,h[l+3],10,2399980690),d=n(d,e,b,c,h[l+10],15,4293915773),c=n(c,d,e,b,h[l+1],21,2240044497),b=n(b,c,d,e,h[l+8],6,1873313359),e=n(e,b,c,d,h[l+15],10,4264355552),d=n(d,e,b,c,h[l+6],15,2734768916),
c=n(c,d,e,b,h[l+13],21,1309151649),b=n(b,c,d,e,h[l+4],6,4149444226),e=n(e,b,c,d,h[l+11],10,3174756917),d=n(d,e,b,c,h[l+2],15,718787259),c=n(c,d,e,b,h[l+9],21,3951481745),b=f(b,q),c=f(c,r),d=f(d,s),e=f(e,t);return(p(b)+p(c)+p(d)+p(e)).toLowerCase()};
akra.crypto.crc32=function(a){a=akra.conv.toUTF8(a);var b,c=0,c=0;b=-1;for(var d=0,e=a.length;d<e;d++)c=(b^a.charCodeAt(d))&255,c=parseInt("0x"+"00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D".substr(9*c,
8),10),b=b>>>8^c;return String(b^-1)};var Array;
akra.typeOf=function(a){var b=typeof a;if("object"===b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"===c)return"object";if("[object Array]"===c||"number"===typeof a.length&&"undefined"!==typeof a.splice&&"undefined"!==typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"===c||"undefined"!==typeof a.call&&"undefined"!==typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"===b&&"undefined"===typeof a.call)return"object";return b};akra.isDef=function(a){return void 0!==a};akra.isDefAndNotNull=function(a){return null!=a};akra.isEmpty=function(a){return 0===a.length};akra.isNull=function(a){return null===a};akra.isBoolean=function(a){return"boolean"===typeof a};akra.isString=function(a){return"string"===typeof a};akra.isNumber=function(a){return"number"===typeof a};akra.isFloat=akra.isNumber;akra.isInt=akra.isNumber;
akra.isFunction=function(a){return"function"===akra.typeOf(a)};akra.isObject=function(a){a=akra.typeOf(a);return"object"===a||"array"===a||"function"===a};akra.isArrayBuffer=function(a){return a instanceof ArrayBuffer};akra.isTypedArray=function(a){return null!==a&&"object"===typeof a&&"number"===typeof a.byteOffset};akra.isBlob=function(a){return a instanceof Blob};akra.isArray=function(a){return"array"===akra.typeOf(a)};
String.prototype.replaceAt=function(a,b){return this.substr(0,a)+b+this.substr(a+b.length)};Object.defineProperty(Array.prototype,"first",{enumerable:!1,configurable:!0,get:function(){return this[0]}});Object.defineProperty(Array.prototype,"last",{enumerable:!1,configurable:!0,get:function(){return this[this.length-1]}});Object.defineProperty(Array.prototype,"el",{enumerable:!1,configurable:!0,value:function(a){a=a||0;return this[0>a?this.length+a:a]}});
Object.defineProperty(Array.prototype,"clear",{enumerable:!1,configurable:!0,value:function(){this.length=0}});Object.defineProperty(Array.prototype,"swap",{enumerable:!1,configurable:!0,value:function(a,b){if(a<this.length&&b<this.length){var c=this[a];this[a]=this[b];this[b]=c}}});Object.defineProperty(Array.prototype,"insert",{enumerable:!1,configurable:!0,value:function(a){if("number"===typeof a.length)for(var b=0,c=a.length;b<c;++b)this.push(a[b]);else this.push(a);return this}});
Number.prototype.toHex=function(a){for(var b=this.toString(16),c=0;c<a-b.length;++c)b="0"+b;return b};Number.prototype.printBinary=function(a){"undefined"===typeof a&&(a=!0);for(var b="",c=0;32>c;++c)c&&0==c%4&&a&&(b=" "+b),this>>c&1?b="1"+b:b="0"+b;return b};akra.ELogLevel={NONE:0,LOG:1,INFORMATION:2,WARNING:4,ERROR:8,CRITICAL:16,ALL:31};akra.ISourceLocation=function(){};akra.ILoggerEntity=function(){};akra.ILogger=function(){};akra.util={};
akra.util.Singleton=function(){var a=this.constructor;if(null!=a._instance)throw Error("Singleton class may be created only one time.");a._instance=this};akra.util.Singleton.getInstance=function(){null===this._instance&&(this._instance=new this);return this._instance};akra.util.Singleton._instance=null;var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype;a.prototype=new c};akra.util.AICodeFamily=function(){};
akra.util.AICodeInfo=function(){};
akra.util.Logger=function(){akra.util.Singleton.call(this);this._eUnknownCode=0;this._sUnknownMessage="Unknown code";this._eLogLevel=akra.ELogLevel.ALL;this._pGeneralRoutineMap={};this._pCurrentSourceLocation={file:"",line:0};this._pLastLogEntity={code:this._eUnknownCode,location:this._pCurrentSourceLocation,message:this._sUnknownMessage,info:null};this._pCodeFamilyMap={};this._pCodeFamilyList=[];this._pCodeInfoMap={};this._pCodeFamilyRoutineDMap={};this._nFamilyGenerator=0};
__extends(akra.util.Logger,akra.util.Singleton);akra.util.Logger.prototype.init=function(){return!0};akra.util.Logger.prototype.setLogLevel=function(a){this._eLogLevel=a};akra.util.Logger.prototype.getLogLevel=function(){return this._eLogLevel};akra.util.Logger.prototype.registerCode=function(a,b){"undefined"===typeof b&&(b=this._sUnknownMessage);if(this.isUsedCode(a))return!1;var c=this.getFamilyName(a);if(akra.isNull(c))return!1;this._pCodeInfoMap[a]={code:a,message:b,familyName:c};return!0};
akra.util.Logger.prototype.setUnknownCode=function(a,b){this._eUnknownCode=a;this._sUnknownMessage=b};akra.util.Logger.prototype.registerCodeFamily=function(a,b,c){"undefined"===typeof c&&(c=this.generateFamilyName());if(this.isUsedFamilyName(c)||!this.isValidCodeInterval(a,b))return!1;a={familyName:c,codeMin:a,codeMax:b};this._pCodeFamilyMap[c]=a;this._pCodeFamilyList.push(a);return!0};
akra.util.Logger.prototype.getFamilyName=function(a){for(var b=0,c=this._pCodeFamilyList,d,b=0;b<c.length;b++)if(d=c[b],d.codeMin<=a&&d.codeMax>=a)return d.familyName;return null};
akra.util.Logger.prototype.setCodeFamilyRoutine=function(a,b,c){var d=null,e=null,f=akra.ELogLevel.LOG;if(akra.isInt(a)){if(d=this.getFamilyName(a),e=b,f=c,akra.isNull(d))return!1}else akra.isString(a)&&(d=a,e=b,f=c);if(!this.isUsedFamilyName(d))return!1;a=this._pCodeFamilyRoutineDMap[d];akra.isDef(a)||(a=this._pCodeFamilyRoutineDMap[d]={});akra.bf.testAll(f,akra.ELogLevel.LOG)&&(a[akra.ELogLevel.LOG]=e);akra.bf.testAll(f,akra.ELogLevel.INFORMATION)&&(a[akra.ELogLevel.INFORMATION]=e);akra.bf.testAll(f,
akra.ELogLevel.WARNING)&&(a[akra.ELogLevel.WARNING]=e);akra.bf.testAll(f,akra.ELogLevel.ERROR)&&(a[akra.ELogLevel.ERROR]=e);akra.bf.testAll(f,akra.ELogLevel.CRITICAL)&&(a[akra.ELogLevel.CRITICAL]=e);return!0};
akra.util.Logger.prototype.setLogRoutine=function(a,b){akra.bf.testAll(b,akra.ELogLevel.LOG)&&(this._pGeneralRoutineMap[akra.ELogLevel.LOG]=a);akra.bf.testAll(b,akra.ELogLevel.INFORMATION)&&(this._pGeneralRoutineMap[akra.ELogLevel.INFORMATION]=a);akra.bf.testAll(b,akra.ELogLevel.WARNING)&&(this._pGeneralRoutineMap[akra.ELogLevel.WARNING]=a);akra.bf.testAll(b,akra.ELogLevel.ERROR)&&(this._pGeneralRoutineMap[akra.ELogLevel.ERROR]=a);akra.bf.testAll(b,akra.ELogLevel.CRITICAL)&&(this._pGeneralRoutineMap[akra.ELogLevel.CRITICAL]=
a)};akra.util.Logger.prototype.setSourceLocation=function(){var a,b;2===arguments.length?(a=arguments[0],b=arguments[1]):akra.isDef(arguments[0])&&!akra.isNull(arguments[0])?(a=arguments[0].file,b=arguments[0].line):(a="",b=0);this._pCurrentSourceLocation.file=a;this._pCurrentSourceLocation.line=b};
akra.util.Logger.prototype.log=function(a){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];if(akra.bf.testAll(this._eLogLevel,akra.ELogLevel.LOG)&&(c=this._pGeneralRoutineMap[akra.ELogLevel.LOG],akra.isDef(c))){var d=this._pLastLogEntity;d.code=this._eUnknownCode;d.location=this._pCurrentSourceLocation;d.info=b;d.message=this._sUnknownMessage;c.call(null,d)}};
akra.util.Logger.prototype.info=function(){if(akra.bf.testAll(this._eLogLevel,akra.ELogLevel.INFORMATION)){var a,b;a=this.prepareLogEntity.apply(this,arguments);b=this.getCodeRoutineFunc(a.code,akra.ELogLevel.INFORMATION);akra.isNull(b)||b.call(null,a)}};akra.util.Logger.prototype.warn=function(){if(akra.bf.testAll(this._eLogLevel,akra.ELogLevel.WARNING)){var a,b;a=this.prepareLogEntity.apply(this,arguments);b=this.getCodeRoutineFunc(a.code,akra.ELogLevel.WARNING);akra.isNull(b)||b.call(null,a)}};
akra.util.Logger.prototype.error=function(){if(akra.bf.testAll(this._eLogLevel,akra.ELogLevel.ERROR)){var a,b;a=this.prepareLogEntity.apply(this,arguments);b=this.getCodeRoutineFunc(a.code,akra.ELogLevel.ERROR);akra.isNull(b)||b.call(null,a)}};
akra.util.Logger.prototype.critical=function(){var a,b;a=this.prepareLogEntity.apply(this,arguments);b=this.getCodeRoutineFunc(a.code,akra.ELogLevel.CRITICAL);var c="A Critical error has occured! Code: "+a.code.toString();akra.bf.testAll(this._eLogLevel,akra.ELogLevel.CRITICAL)&&!akra.isNull(b)&&b.call(null,a);alert(c);throw Error(c);};
akra.util.Logger.prototype.assert=function(){if(!arguments[0]){var a,b;a=[];for(b=1;b<arguments.length;b++)a[b-1]=arguments[b];a=this.prepareLogEntity.apply(this,a);b=this.getCodeRoutineFunc(a.code,akra.ELogLevel.CRITICAL);var c="A error has occured! Code: "+a.code.toString()+"\n Accept to exit, refuse to continue.";akra.bf.testAll(this._eLogLevel,akra.ELogLevel.CRITICAL)&&!akra.isNull(b)&&b.call(null,a);if(confirm(c))throw Error(c);}};akra.util.Logger.prototype.presume=function(){};
akra.util.Logger.prototype.generateFamilyName=function(){var a=this._nFamilyGenerator++,a=akra.util.Logger._sDefaultFamilyName+a;return this.isUsedFamilyName(a)?this.generateFamilyName():a};akra.util.Logger.prototype.isValidCodeInterval=function(a,b){if(a>b)return!1;for(var c=0,d=this._pCodeFamilyList,e,c=0;c<d.length;c++)if(e=d[c],e.codeMin<=a&&e.codeMax>=a||e.codeMin<=b&&e.codeMax>=b)return!1;return!0};akra.util.Logger.prototype.isUsedFamilyName=function(a){return akra.isDef(this._pCodeFamilyMap[a])};
akra.util.Logger.prototype.isUsedCode=function(a){return akra.isDef(this._pCodeInfoMap[a])};akra.util.Logger.prototype.isLogEntity=function(a){return akra.isObject(a)&&akra.isDef(a.code)&&akra.isDef(a.location)?!0:!1};akra.util.Logger.prototype.isLogCode=function(a){return akra.isInt(a)};
akra.util.Logger.prototype.prepareLogEntity=function(){var a=this._eUnknownCode,b=this._sUnknownMessage,c=null;if(1===arguments.length&&this.isLogEntity(arguments[0])){var d=arguments[0],a=d.code,c=d.info;this.setSourceLocation(d.location);akra.isDef(d.message)||(d=this._pCodeInfoMap[a],akra.isDef(d)&&(b=d.message))}else{if(this.isLogCode(arguments[0])){if(a=arguments[0],1<arguments.length)for(c=Array(arguments.length-1),d=d=0;d<c.length;d++)c[d]=arguments[d+1]}else for(a=this._eUnknownCode,c=Array(arguments.length),
d=0;d<c.length;d++)c[d]=arguments[d];d=this._pCodeInfoMap[a];akra.isDef(d)&&(b=d.message)}d=this._pLastLogEntity;d.code=a;d.location=this._pCurrentSourceLocation;d.message=b;d.info=c;return d};akra.util.Logger.prototype.getCodeRoutineFunc=function(a,b){var c=this._pCodeInfoMap[a];if(!akra.isDef(c))return c=this._pGeneralRoutineMap[b],akra.isDef(c)?c:null;c=this._pCodeFamilyRoutineDMap[c.familyName];return akra.isDef(c)&&akra.isDef(c[b])?c=c[b]:(c=this._pGeneralRoutineMap[b],akra.isDef(c)?c:null)};
akra.util.Logger._sDefaultFamilyName="CodeFamily";akra.logger=akra.util.Logger.getInstance();akra.logger.init();akra.logger.setUnknownCode(0,"unknown");akra.logger.setLogLevel(akra.ELogLevel.ALL);akra.sourceLocationToString=function(a){var b=new Date,b=b.getHours()+":"+b.getMinutes()+"."+b.getSeconds();return"["+a.file+":"+a.line.toString()+" "+b+"]: "};
akra.logRoutine=function(a){var b=a.info;a=akra.sourceLocationToString(a.location);akra.isString(b[0])?b[0]=a+" "+b[0]:b.unshift(a);console.log.apply(console,b)};akra.warningRoutine=function(a){var b=a.info,c="Code: "+a.code.toString()+".";a=akra.sourceLocationToString(a.location);akra.isString(b[0])?b[0]=a+" "+c+" "+b[0]:b.unshift(a+" "+c);console.warn.apply(console,b)};
akra.errorRoutine=function(a){var b=a.info,c=a.message,d="Error code: "+a.code.toString()+".";a=akra.sourceLocationToString(a.location);akra.isString(b[0])?b[0]=a+" "+d+" "+c+" "+b[0]:b.unshift(a+" "+d+" "+c);console.error.apply(console,b)};akra.logger.setLogRoutine(akra.logRoutine,akra.ELogLevel.LOG|akra.ELogLevel.INFORMATION);akra.logger.setLogRoutine(akra.warningRoutine,akra.ELogLevel.WARNING);akra.logger.setLogRoutine(akra.errorRoutine,akra.ELogLevel.ERROR|akra.ELogLevel.CRITICAL);
akra.parser.END_POSITION="END";akra.parser.T_EMPTY="EMPTY";akra.parser.UNKNOWN_TOKEN="UNNOWN";akra.parser.START_SYMBOL="S";akra.parser.UNUSED_SYMBOL="##";akra.parser.END_SYMBOL="$";akra.parser.LEXER_RULES="--LEXER--";akra.parser.FLAG_RULE_CREATE_NODE="--AN";akra.parser.FLAG_RULE_NOT_CREATE_NODE="--NN";akra.parser.FLAG_RULE_FUNCTION="--F";akra.parser.EOF="EOF";akra.parser.T_STRING="T_STRING";akra.parser.T_FLOAT="T_FLOAT";akra.parser.T_UINT="T_UINT";akra.parser.T_TYPE_ID="T_TYPE_ID";
akra.parser.T_NON_TYPE_ID="T_NON_TYPE_ID";akra.parser.LEXER_UNKNOWN_TOKEN=2101;akra.parser.LEXER_BAD_TOKEN=2102;akra.logger.registerCodeFamily(2E3,2199,"ParserSyntaxErrors");akra.logger.registerCode(akra.parser.LEXER_UNKNOWN_TOKEN,"Unknown token: {tokenValue}");akra.logger.registerCode(akra.parser.LEXER_BAD_TOKEN,"Bad token: {tokenValue}");
akra.parser.Lexer=function(a){this._iColumnNumber=this._iLineNumber=0;this._sSource="";this._iIndex=0;this._pParser=a;this._pPunctuatorsMap={};this._pKeywordsMap={};this._pPunctuatorsFirstSymbols={}};akra.parser.Lexer.getPunctuatorName=function(a){return"T_PUNCTUATOR_"+a.charCodeAt(0)};akra.parser.Lexer.prototype.addPunctuator=function(a,b){"undefined"===typeof b&&(b=akra.parser.Lexer.getPunctuatorName(a));this._pPunctuatorsMap[a]=b;this._pPunctuatorsFirstSymbols[a[0]]=!0;return b};
akra.parser.Lexer.prototype.addKeyword=function(a,b){return this._pKeywordsMap[a]=b};akra.parser.Lexer.prototype.getTerminalValueByName=function(a){var b=null;for(b in this._pPunctuatorsMap)if(this._pPunctuatorsMap[b]===a)return b;for(b in this._pKeywordsMap)if(this._pKeywordsMap[b]===a)return b;return a};akra.parser.Lexer.prototype.init=function(a){this._sSource=a;this._iIndex=this._iColumnNumber=this._iLineNumber=0};
akra.parser.Lexer.prototype.getNextToken=function(){var a=this.currentChar();if(!a)return{name:akra.parser.END_SYMBOL,value:akra.parser.END_SYMBOL,start:this._iColumnNumber,end:this._iColumnNumber,line:this._iLineNumber};var b;switch(this.identityTokenType()){case akra.parser.ETokenType.k_NumericLiteral:b=this.scanNumber();break;case akra.parser.ETokenType.k_CommentLiteral:this.scanComment();b=this.getNextToken();break;case akra.parser.ETokenType.k_StringLiteral:b=this.scanString();break;case akra.parser.ETokenType.k_PunctuatorLiteral:b=
this.scanPunctuator();break;case akra.parser.ETokenType.k_IdentifierLiteral:b=this.scanIdentifier();break;case akra.parser.ETokenType.k_WhitespaceLiteral:this.scanWhiteSpace();b=this.getNextToken();break;default:this._error(akra.parser.LEXER_UNKNOWN_TOKEN,{name:akra.parser.UNKNOWN_TOKEN,value:a+this._sSource[this._iIndex+1],start:this._iColumnNumber,end:this._iColumnNumber+1,line:this._iLineNumber})}return b};akra.parser.Lexer.prototype._getIndex=function(){return this._iIndex};
akra.parser.Lexer.prototype._setSource=function(a){this._sSource=a};akra.parser.Lexer.prototype._setIndex=function(a){this._iIndex=a};akra.parser.Lexer.prototype._error=function(a,b){var c={file:this._pParser.getParseFileName(),line:this._iLineNumber};akra.logger.error({code:a,info:{tokenValue:b.value,tokenType:b.type},location:c});throw Error(a.toString());};
akra.parser.Lexer.prototype.identityTokenType=function(){return this.isIdentifierStart()?akra.parser.ETokenType.k_IdentifierLiteral:this.isWhiteSpaceStart()?akra.parser.ETokenType.k_WhitespaceLiteral:this.isStringStart()?akra.parser.ETokenType.k_StringLiteral:this.isCommentStart()?akra.parser.ETokenType.k_CommentLiteral:this.isNumberStart()?akra.parser.ETokenType.k_NumericLiteral:this.isPunctuatorStart()?akra.parser.ETokenType.k_PunctuatorLiteral:akra.parser.ETokenType.k_Unknown};
akra.parser.Lexer.prototype.isNumberStart=function(){var a=this.currentChar();if("0"<=a&&"9">=a)return!0;var b=this.nextChar();return"."===a&&"0"<=b&&"9">=b?!0:!1};akra.parser.Lexer.prototype.isCommentStart=function(){var a=this.currentChar(),b=this.nextChar();return"/"!==a||"/"!==b&&"*"!==b?!1:!0};akra.parser.Lexer.prototype.isStringStart=function(){var a=this.currentChar();return'"'===a||"'"===a?!0:!1};
akra.parser.Lexer.prototype.isPunctuatorStart=function(){var a=this.currentChar();return this._pPunctuatorsFirstSymbols[a]?!0:!1};akra.parser.Lexer.prototype.isWhiteSpaceStart=function(){var a=this.currentChar();return" "===a||"\n"===a||"\r"===a||"\t"===a?!0:!1};akra.parser.Lexer.prototype.isIdentifierStart=function(){var a=this.currentChar();return"_"===a||"a"<=a&&"z">=a||"A"<=a&&"Z">=a?!0:!1};
akra.parser.Lexer.prototype.isLineTerminator=function(a){return"\n"===a||"\r"===a||"\u2028"===a||"\u2029"===a};akra.parser.Lexer.prototype.isWhiteSpace=function(a){return" "===a||"\t"===a};akra.parser.Lexer.prototype.isKeyword=function(a){return!!this._pKeywordsMap[a]};akra.parser.Lexer.prototype.isPunctuator=function(a){return!!this._pPunctuatorsMap[a]};akra.parser.Lexer.prototype.nextChar=function(){return this._sSource[this._iIndex+1]};akra.parser.Lexer.prototype.currentChar=function(){return this._sSource[this._iIndex]};
akra.parser.Lexer.prototype.readNextChar=function(){this._iIndex++;this._iColumnNumber++;return this._sSource[this._iIndex]};
akra.parser.Lexer.prototype.scanString=function(){for(var a=this.currentChar(),b=a,c=null,d=a,e=!1,f=this._iColumnNumber;;){c=this.readNextChar();if(!c)break;b+=c;if(c===a&&"\\"!==d){e=!0;this.readNextChar();break}d=c}if(e)return{name:akra.parser.T_STRING,value:b,start:f,end:this._iColumnNumber-1,line:this._iLineNumber};c||(c=akra.parser.EOF);this._error(akra.parser.LEXER_BAD_TOKEN,{type:akra.parser.ETokenType.k_StringLiteral,value:b+c,start:f,end:this._iColumnNumber,line:this._iLineNumber});return null};
akra.parser.Lexer.prototype.scanPunctuator=function(){for(var a=this.currentChar(),b,c=this._iColumnNumber;;)if(b=this.readNextChar()){if(a+=b,this._iColumnNumber++,!this.isPunctuator(a)){a=a.slice(0,a.length-1);break}}else break;return{name:this._pPunctuatorsMap[a],value:a,start:c,end:this._iColumnNumber-1,line:this._iLineNumber}};
akra.parser.Lexer.prototype.scanNumber=function(){var a=this.currentChar(),b="",c=!1,d=a,e=!1,f=this._iColumnNumber,g=!1;"."===a&&(b+=0,c=!0);for(b+=a;;){a=this.readNextChar();if("."===a)if(c)break;else c=!0;else if("e"===a)if(g)break;else g=!0;else if(("+"===a||"-"===a)&&"e"===d){b+=a;d=a;continue}else if("f"===a&&c){a=this.readNextChar();if("a"<=a&&"z">=a||"A"<=a&&"Z">=a)break;e=!0;break}else if("a"<=a&&"z">=a||"A"<=a&&"Z">=a)break;else if(!("0"<=a&&"9">=a&&a)){if(g&&"+"!==d&&"-"!==d&&"e"!==d||
!g)e=!0;break}b+=a;d=a}if(e)return{name:c?akra.parser.T_FLOAT:akra.parser.T_UINT,value:b,start:f,end:this._iColumnNumber-1,line:this._iLineNumber};a||(a=akra.parser.EOF);this._error(akra.parser.LEXER_BAD_TOKEN,{type:akra.parser.ETokenType.k_NumericLiteral,value:b+a,start:f,end:this._iColumnNumber,line:this._iLineNumber});return null};
akra.parser.Lexer.prototype.scanIdentifier=function(){for(var a=this.currentChar(),b=a,c=this._iColumnNumber,d=!1;;){a=this.readNextChar();if(!a){d=!0;break}if(!("_"===a||"a"<=a&&"z">=a||"A"<=a&&"Z">=a||"0"<=a&&"9">=a)){d=!0;break}b+=a}if(d)return this.isKeyword(b)?{name:this._pKeywordsMap[b],value:b,start:c,end:this._iColumnNumber-1,line:this._iLineNumber}:{name:this._pParser.isTypeId(b)?akra.parser.T_TYPE_ID:akra.parser.T_NON_TYPE_ID,value:b,start:c,end:this._iColumnNumber-1,line:this._iLineNumber};
a||(a=akra.parser.EOF);this._error(akra.parser.LEXER_BAD_TOKEN,{type:akra.parser.ETokenType.k_IdentifierLiteral,value:b+a,start:c,end:this._iColumnNumber,line:this._iLineNumber});return null};akra.parser.Lexer.prototype.scanWhiteSpace=function(){for(var a=this.currentChar();a;)if(this.isLineTerminator(a))"\r"===a&&"\n"===this.nextChar()&&this._iLineNumber--,this._iLineNumber++,a=this.readNextChar(),this._iColumnNumber=0;else{if("\t"===a)this._iColumnNumber+=3;else if(" "!==a)break;a=this.readNextChar()}return!0};
akra.parser.Lexer.prototype.scanComment=function(){var a=this.currentChar(),b=this.readNextChar(),a=a+b;if("/"===b){for(;;){b=this.readNextChar();if(!b)break;if(this.isLineTerminator(b)){"\r"===b&&"\n"===this.nextChar()&&this._iLineNumber--;this._iLineNumber++;this.readNextChar();this._iColumnNumber=0;break}a+=b}return!0}for(var c=b,d=!1,e=this._iColumnNumber;;){b=this.readNextChar();if(!b)break;a+=b;if("/"===b&&"*"===c){d=!0;this.readNextChar();break}this.isLineTerminator(b)&&("\r"===b&&"\n"===this.nextChar()&&
this._iLineNumber--,this._iLineNumber++,this._iColumnNumber=-1);c=b}if(d)return!0;b||(b=akra.parser.EOF);this._error(akra.parser.LEXER_BAD_TOKEN,{type:akra.parser.ETokenType.k_CommentLiteral,value:a+b,start:e,end:this._iColumnNumber,line:this._iLineNumber});return!1};akra.parser.ParseTree=function(){this._pRoot=null;this._pNodes=[];this._pNodesCountStack=[];this._isOptimizeMode=!1};akra.parser.ParseTree.prototype.getRoot=function(){return this._pRoot};
akra.parser.ParseTree.prototype.setRoot=function(a){this._pRoot=a};akra.parser.ParseTree.prototype.finishTree=function(){this._pRoot=this._pNodes.pop()};akra.parser.ParseTree.prototype.setOptimizeMode=function(a){this._isOptimizeMode=a};akra.parser.ParseTree.prototype.addNode=function(a){this._pNodes.push(a);this._pNodesCountStack.push(1)};
akra.parser.ParseTree.prototype.reduceByRule=function(a,b){"undefined"===typeof b&&(b=akra.parser.ENodeCreateMode.k_Default);var c=0,d=this._pNodesCountStack,e;e=a.right.length;for(var f=this._pNodes,g=this._isOptimizeMode?1:0;e;)c+=d.pop(),e--;if(b===akra.parser.ENodeCreateMode.k_Default&&c>g||b===akra.parser.ENodeCreateMode.k_Necessary){for(e={name:a.left,children:null,parent:null,value:"",isAnalyzed:!1,position:this._pNodes.length};c;)this.addLink(e,f.pop()),c-=1;f.push(e);d.push(1)}else d.push(c)};
akra.parser.ParseTree.prototype.toString=function(){return this._pRoot?this.toStringNode(this._pRoot):""};akra.parser.ParseTree.prototype.clone=function(){var a=new akra.parser.ParseTree;a.setRoot(this.cloneNode(this._pRoot));return a};akra.parser.ParseTree.prototype.getNodes=function(){return this._pNodes};akra.parser.ParseTree.prototype.getLastNode=function(){return this._pNodes[this._pNodes.length-1]};
akra.parser.ParseTree.prototype.addLink=function(a,b){a.children||(a.children=[]);a.children.push(b);b.parent=a};akra.parser.ParseTree.prototype.cloneNode=function(a){var b;b={name:a.name,value:a.value,children:null,parent:null,isAnalyzed:a.isAnalyzed,position:a.position};a=a.children;for(var c=0;a&&c<a.length;c++)this.addLink(b,this.cloneNode(a[c]));return b};
akra.parser.ParseTree.prototype.toStringNode=function(a,b){"undefined"===typeof b&&(b="");var c=b+"{\n",d=b;b+="  ";if(a.value)c+=b+'name : "'+a.name+'",\n',c+=b+'value : "'+a.value+'"\n';else{var c=c+(b+'name : "'+a.name+'"\n'),c=c+(b+"children : ["),e=a.children;if(e){c+="\n";b+="  ";for(var f=e.length-1;0<=f;f--)c+=this.toStringNode(e[f],b),c+=",\n";c=c.slice(0,c.length-2);c=c+"\n"+(d+"  ]\n")}else c+=" ]\n"}return c+=d+"}"};akra.parser.IState=function(){};akra.parser.IItem=function(){};
akra.parser.Item=function(a,b,c){this._pRule=a;this._iPos=b;this._iIndex=0;this._pState=null;this._isNewExpected=!0;this._iLength=0;this._pExpected={};if(3===arguments.length)for(var d=Object.getOwnPropertyNames(arguments[2]),e=0;e<d.length;e++)this.addExpected(d[e])};akra.parser.Item.prototype.getRule=function(){return this._pRule};akra.parser.Item.prototype.setRule=function(a){this._pRule=a};akra.parser.Item.prototype.getPosition=function(){return this._iPos};
akra.parser.Item.prototype.setPosition=function(a){this._iPos=a};akra.parser.Item.prototype.getState=function(){return this._pState};akra.parser.Item.prototype.setState=function(a){this._pState=a};akra.parser.Item.prototype.getIndex=function(){return this._iIndex};akra.parser.Item.prototype.setIndex=function(a){this._iIndex=a};akra.parser.Item.prototype.getIsNewExpected=function(){return this._isNewExpected};akra.parser.Item.prototype.setIsNewExpected=function(a){this._isNewExpected=a};
akra.parser.Item.prototype.getExpectedSymbols=function(){return this._pExpected};akra.parser.Item.prototype.getLength=function(){return this._iLength};
akra.parser.Item.prototype.isEqual=function(a,b){"undefined"===typeof b&&(b=akra.parser.EParserType.k_LR0);if(b===akra.parser.EParserType.k_LR0)return this._pRule===a.getRule()&&this._iPos===a.getPosition();if(b===akra.parser.EParserType.k_LR1){if(this._pRule!==a.getRule()||this._iPos!==a.getPosition()||this._iLength!==a.getLength())return!1;var c=null;for(c in this._pExpected)if(!a.isExpected(c))return!1;return!0}return!1};
akra.parser.Item.prototype.isParentItem=function(a){return this._pRule===a.getRule()&&this._iPos===a.getPosition()+1};akra.parser.Item.prototype.isChildItem=function(a){return this._pRule===a.getRule()&&this._iPos===a.getPosition()-1};akra.parser.Item.prototype.mark=function(){var a=this._pRule.right;return this._iPos===a.length?akra.parser.END_POSITION:a[this._iPos]};akra.parser.Item.prototype.end=function(){return this._pRule.right[this._pRule.right.length-1]||akra.parser.T_EMPTY};
akra.parser.Item.prototype.nextMarked=function(){return this._pRule.right[this._iPos+1]||akra.parser.END_POSITION};akra.parser.Item.prototype.isExpected=function(a){return!!this._pExpected[a]};akra.parser.Item.prototype.addExpected=function(a){if(this._pExpected[a])return!1;this._isNewExpected=this._pExpected[a]=!0;this._iLength++;return!0};
akra.parser.Item.prototype.toString=function(){for(var a=this._pRule.left+" -> ",b="",b=this._pRule.right,c=0;c<b.length;c++)c===this._iPos&&(a+=". "),a+=b[c]+" ";this._iPos===b.length&&(a+=". ");if(akra.isDef(this._pExpected)){for(var b=", ",c=Object.getOwnPropertyNames(this._pExpected),d=0;d<c.length;++d)b+=c[d]+"/";", "!==b&&(a+=b)}return a=a.slice(0,a.length-1)};akra.parser.State=function(){this._pItemList=[];this._pNextStates={};this._nBaseItems=this._iIndex=0};
akra.parser.State.prototype.getIndex=function(){return this._iIndex};akra.parser.State.prototype.setIndex=function(a){this._iIndex=a};akra.parser.State.prototype.getItems=function(){return this._pItemList};akra.parser.State.prototype.getNumBaseItems=function(){return this._nBaseItems};akra.parser.State.prototype.getNextStates=function(){return this._pNextStates};akra.parser.State.prototype.hasItem=function(a,b){var c,d=this._pItemList;for(c=0;c<d.length;c++)if(d[c].isEqual(a,b))return d[c];return null};
akra.parser.State.prototype.hasParentItem=function(a){var b,c=this._pItemList;for(b=0;b<c.length;b++)if(c[b].isParentItem(a))return c[b];return null};akra.parser.State.prototype.hasChildItem=function(a){var b,c=this._pItemList;for(b=0;b<c.length;b++)if(c[b].isChildItem(a))return c[b];return null};akra.parser.State.prototype.hasRule=function(a,b){for(var c=0,d=this._pItemList,e,c=0;c<this._nBaseItems;c++)if(e=d[c],e.getRule()===a&&e.getPosition()===b)return!0;return!1};
akra.parser.State.prototype.isEmpty=function(){return!this._pItemList.length};akra.parser.State.prototype.isEqual=function(a,b){var c=this._pItemList,d=a.getItems();if(this._nBaseItems!==a.getNumBaseItems())return!1;var e=this._nBaseItems,f,g,k;for(f=0;f<e;f++){k=!1;for(g=0;g<e;g++)if(c[f].isEqual(d[g],b)){k=!0;break}if(!k)return!1}return!0};akra.parser.State.prototype.push=function(a){if(0===this._pItemList.length||0<a.getPosition())this._nBaseItems+=1;a.setState(this);this._pItemList.push(a)};
akra.parser.State.prototype.tryPush_LR0=function(a,b){var c,d=this._pItemList;for(c=0;c<d.length;c++)if(d[c].getRule()===a&&d[c].getPosition()===b)return!1;c=new akra.parser.Item(a,b);this.push(c);return!0};akra.parser.State.prototype.tryPush_LR=function(a,b,c){var d,e=this._pItemList;for(d=0;d<e.length;d++)if(e[d].getRule()===a&&e[d].getPosition()===b)return e[d].addExpected(c);d={};d[c]=!0;a=new akra.parser.Item(a,b,d);this.push(a);return!0};
akra.parser.State.prototype.getNextStateBySymbol=function(a){return akra.isDef(this._pNextStates[a])?this._pNextStates[a]:null};akra.parser.State.prototype.addNextState=function(a,b){if(akra.isDef(this._pNextStates[a]))return!1;this._pNextStates[a]=b;return!0};akra.parser.State.prototype.deleteNotBase=function(){this._pItemList.length=this._nBaseItems};
akra.parser.State.prototype.toString=function(a){var b=0,c,d=this._pItemList;c="State "+this._iIndex+":\n";b=a?this._nBaseItems:d.length;for(a=0;a<b;a++)c+="\t\t",c+=d[a].toString(),c+="\n";return c};akra.parser.PARSER_GRAMMAR_ADD_OPERATION=2001;akra.parser.PARSER_GRAMMAR_ADD_STATE_LINK=2002;akra.parser.PARSER_GRAMMAR_UNEXPECTED_SYMBOL=2003;akra.parser.PARSER_GRAMMAR_BAD_ADDITIONAL_FUNC_NAME=2004;akra.parser.PARSER_GRAMMAR_BAD_KEYWORD=2005;akra.parser.PARSER_SYNTAX_ERROR=2051;
akra.logger.registerCode(akra.parser.PARSER_GRAMMAR_ADD_OPERATION,'Grammar not LALR(1)! Cannot to generate syntax table. Add operation error.\nConflict in state with index: {stateIndex}. With grammar symbol: "{grammarSymbol}"\nOld operation: {oldOperation}\nNew operation: {newOperation}\nFor more info init parser in debug-mode and see syntax table and list of states.');akra.logger.registerCode(akra.parser.PARSER_GRAMMAR_ADD_STATE_LINK,'Grammar not LALR(1)! Cannot to generate syntax table. Add state link error.\nConflict in state with index: {stateIndex}. With grammar symbol: "{grammarSymbol}"\nOld next state: {oldNextStateIndex}\nNew next state: {newNextStateIndex}\nFor more info init parser in debug-mode and see syntax table and list of states.');
akra.logger.registerCode(akra.parser.PARSER_GRAMMAR_UNEXPECTED_SYMBOL,"Grammar error. Can`t generate rules from grammar\nUnexpected symbol: {unexpectedSymbol}\nExpected: {expectedSymbol}");akra.logger.registerCode(akra.parser.PARSER_GRAMMAR_BAD_ADDITIONAL_FUNC_NAME,"Grammar error. Empty additional function name.");akra.logger.registerCode(akra.parser.PARSER_GRAMMAR_BAD_KEYWORD,"Grammar error. Bad keyword: {badKeyword}\nAll keyword must be define in lexer rule block.");
akra.logger.registerCode(akra.parser.PARSER_SYNTAX_ERROR,"Syntax error during parsing. Token: {tokenValue}\nLine: {line}. Column: {column}.");akra.parser.sourceLocationToString=function(a){return"["+a.file+":"+a.line.toString()+"]: "};
akra.parser.syntaxErrorLogRoutine=function(a){var b=akra.parser.sourceLocationToString(a.location),c="Code: "+a.code.toString()+". ",d=a.message.split(/\{(\w+)\}/);a=a.info;for(var e=0;e<d.length;e++)akra.isDef(a[d[e]])&&(d[e]=a[d[e]]);b=b+c+d.join("");console.error.call(console,b)};akra.logger.setCodeFamilyRoutine("ParserSyntaxErrors",akra.parser.syntaxErrorLogRoutine,akra.ELogLevel.ERROR);akra.parser.IOperation=function(){};akra.parser.IAdditionalFuncInfo=function(){};
akra.parser.Parser=function(){this._sSource="";this._iIndex=0;this._pLexer=this._pTypeIdMap=this._pSyntaxTree=null;this._pStack=[];this._pCaller=this._fnFinishCallback=this._pToken=null;this._pSymbolMap={END_SYMBOL:!0};this._pStateList=this._pRulesDMap=this._pFollowTerminalsDMap=this._pFirstTerminalsDMap=this._pSuccessOperation=this._pShiftOperationsMap=this._pReduceOperationsMap=this._pSyntaxTable=null;this._nRules=0;this._pAdidtionalFunctByStateDMap=this._pAdditionalFunctionsMap=this._pAdditionalFuncInfoList=
null;this._eType=akra.parser.EParserType.k_LR0;this._pRuleCreationModeMap=null;this._eParseMode=akra.parser.EParseMode.k_AllNode;this._pExpectedExtensionDMap=this._pBaseItemList=this._pStatesTempMap=null;this._sFileName="stdin"};akra.parser.Parser.prototype.isTypeId=function(a){return!!this._pTypeIdMap[a]};akra.parser.Parser.prototype.returnCode=function(a){if(a){if(a.value)return a.value+" ";if(a.children){for(var b="",c=0,c=a.children.length-1;0<=c;c--)b+=this.returnCode(a.children[c]);return b}}return""};
akra.parser.Parser.prototype.init=function(a,b,c){"undefined"===typeof b&&(b=akra.parser.EParseMode.k_AllNode);"undefined"===typeof c&&(c=akra.parser.EParserType.k_LALR);try{return this._eType=c,this._pLexer=new akra.parser.Lexer(this),this._eParseMode=b,this.generateRules(a),this.buildSyntaxTable(),this.generateFunctionByStateMap(),akra.bf.testAll(b,akra.parser.EParseMode.k_DebugMode)||this.clearMem(),!0}catch(d){return akra.logger.log(d.stack),!1}};
akra.parser.Parser.prototype.parse=function(a,b,c){"undefined"===typeof b&&(b=null);"undefined"===typeof c&&(c=null);try{this.defaultInit();this._sSource=a;this._pLexer.init(a);this._fnFinishCallback=b;this._pCaller=c;var d=this._pSyntaxTree,e=this._pStack,f=this._pSyntaxTable;c=b=a=!1;for(var g=this.readToken(),k,m,n,p=0;!a;)if(k=f[e[e.length-1]][g.name],akra.isDef(k))switch(k.type){case akra.parser.EOperationType.k_Success:a=!0;break;case akra.parser.EOperationType.k_Shift:p=k.index;e.push(p);d.addNode(g);
n=this.operationAdditionalAction(p,g.name);n===akra.parser.EOperationType.k_Error?a=b=!0:n===akra.parser.EOperationType.k_Pause?(this._pToken=null,c=a=!0):n===akra.parser.EOperationType.k_Ok&&(g=this.readToken());break;case akra.parser.EOperationType.k_Reduce:m=k.rule.right.length,e.length-=m,p=f[e[e.length-1]][k.rule.left].index,e.push(p),d.reduceByRule(k.rule,this._pRuleCreationModeMap[k.rule.left]),n=this.operationAdditionalAction(p,k.rule.left),n===akra.parser.EOperationType.k_Error?a=b=!0:n===
akra.parser.EOperationType.k_Pause&&(this._pToken=g,c=a=!0)}else a=b=!0}catch(h){return this._sFileName="stdin",akra.parser.EParserCode.k_Error}if(c)return akra.parser.EParserCode.k_Pause;if(b)return this._error(akra.parser.PARSER_SYNTAX_ERROR,g),akra.isNull(this._fnFinishCallback)||this._fnFinishCallback.call(this._pCaller,akra.parser.EParserCode.k_Error,this.getParseFileName()),this._sFileName="stdin",akra.parser.EParserCode.k_Error;d.finishTree();akra.isNull(this._fnFinishCallback)||this._fnFinishCallback.call(this._pCaller,
akra.parser.EParserCode.k_Ok,this.getParseFileName());this._sFileName="stdin";return akra.parser.EParserCode.k_Ok};akra.parser.Parser.prototype.setParseFileName=function(a){this._sFileName=a};akra.parser.Parser.prototype.getParseFileName=function(){return this._sFileName};akra.parser.Parser.prototype.pause=function(){return akra.parser.EParserCode.k_Pause};akra.parser.Parser.prototype.resume=function(){return this.resumeParse()};
akra.parser.Parser.prototype.printStates=function(a){"undefined"===typeof a&&(a=!0);akra.isDef(this._pStateList)?(a="\n"+this.statesToString(a),akra.logger.log(a)):akra.logger.log("It`s impossible to print states. You must init parser in debug-mode")};
akra.parser.Parser.prototype.printState=function(a,b){"undefined"===typeof b&&(b=!0);if(akra.isDef(this._pStateList)){var c=this._pStateList[a];akra.isDef(c)?(c="\n"+c.toString(b),akra.logger.log(c)):akra.logger.log("Can not print stete with index: "+a.toString())}else akra.logger.log("It`s impossible to print states. You must init parser in debug-mode")};akra.parser.Parser.prototype.getGrammarSymbols=function(){return this._pGrammarSymbols};akra.parser.Parser.prototype.getSyntaxTree=function(){return this._pSyntaxTree};
akra.parser.Parser.prototype._saveState=function(){return{source:this._sSource,index:this._pLexer._getIndex(),fileName:this._sFileName,tree:this._pSyntaxTree,types:this._pTypeIdMap,stack:this._pStack,token:this._pToken,fnCallback:this._fnFinishCallback,caller:this._pCaller}};
akra.parser.Parser.prototype._loadState=function(a){this._sSource=a.source;this._iIndex=a.index;this._sFileName=a.fileName;this._pSyntaxTree=a.tree;this._pTypeIdMap=a.types;this._pStack=a.stack;this._pToken=a.token;this._fnFinishCallback=a.fnCallback;this._pCaller=a.caller;this._pLexer._setSource(a.source);this._pLexer._setIndex(a.index)};
akra.parser.Parser.prototype.addAdditionalFunction=function(a,b){akra.isNull(this._pAdditionalFunctionsMap)&&(this._pAdditionalFunctionsMap={});this._pAdditionalFunctionsMap[a]=b};akra.parser.Parser.prototype.addTypeId=function(a){akra.isNull(this._pTypeIdMap)&&(this._pTypeIdMap={});this._pTypeIdMap[a]=!0};
akra.parser.Parser.prototype.defaultInit=function(){this._iIndex=0;this._pStack=[0];this._pSyntaxTree=new akra.parser.ParseTree;this._pTypeIdMap={};this._pSyntaxTree.setOptimizeMode(akra.bf.testAll(this._eParseMode,akra.parser.EParseMode.k_Optimize))};
akra.parser.Parser.prototype._error=function(a,b){var c={},d={tokenValue:null,line:null,column:null,stateIndex:null,oldNextStateIndex:null,newNextStateIndex:null,grammarSymbol:null,newOperation:null,oldOperation:null,expectedSymbol:null,unexpectedSymbol:null,badKeyword:null},e={code:a,info:d,location:c},f,g,k,m;a===akra.parser.PARSER_SYNTAX_ERROR?(f=b.line,g=b.start,d.tokenValue=b.value,d.line=f,d.column=g,c.file=this.getParseFileName(),c.line=f):a===akra.parser.PARSER_GRAMMAR_ADD_OPERATION?(f=b.stateIndex,
g=b.grammarSymbol,k=b.oldOperation,m=b.newOperation,d.stateIndex=f,d.grammarSymbol=g,d.oldOperation=this.operationToString(k),d.newOperation=this.operationToString(m),c.file="GRAMMAR",c.line=0):a===akra.parser.PARSER_GRAMMAR_ADD_STATE_LINK?(f=b.stateIndex,g=b.grammarSymbol,k=b.oldNextStateIndex,m=b.newNextStateIndex,d.stateIndex=f,d.grammarSymbol=g,d.oldNextStateIndex=k,d.newNextStateIndex=m,c.file="GRAMMAR",c.line=0):a===akra.parser.PARSER_GRAMMAR_UNEXPECTED_SYMBOL?(f=b.grammarLine,g=b.expectedSymbol,
d.expectedSymbol=g,d.unexpectedSymbol=g,c.file="GRAMMAR",c.line=f||0):a===akra.parser.PARSER_GRAMMAR_BAD_ADDITIONAL_FUNC_NAME?(f=b.grammarLine,c.file="GRAMMAR",c.line=f||0):a===akra.parser.PARSER_GRAMMAR_BAD_KEYWORD&&(f=b.grammarLine,g=b.badKeyword,d.badKeyword=g,c.file="GRAMMAR",c.line=f||0);akra.logger.error(e);throw Error(a.toString());};
akra.parser.Parser.prototype.clearMem=function(){delete this._pFirstTerminalsDMap;delete this._pFollowTerminalsDMap;delete this._pRulesDMap;delete this._pStateList;delete this._pReduceOperationsMap;delete this._pShiftOperationsMap;delete this._pSuccessOperation;delete this._pStatesTempMap;delete this._pBaseItemList;delete this._pExpectedExtensionDMap};akra.parser.Parser.prototype.hasState=function(a,b){for(var c=this._pStateList,d=0,d=0;d<c.length;d++)if(c[d].isEqual(a,b))return c[d];return null};
akra.parser.Parser.prototype.isTerminal=function(a){return!this._pRulesDMap[a]};akra.parser.Parser.prototype.pushState=function(a){a.setIndex(this._pStateList.length);this._pStateList.push(a)};akra.parser.Parser.prototype.pushBaseItem=function(a){a.setIndex(this._pBaseItemList.length);this._pBaseItemList.push(a)};
akra.parser.Parser.prototype.tryAddState=function(a,b){var c=this.hasState(a,b);if(akra.isNull(c)){if(b===akra.parser.EParserType.k_LR0)for(var c=a.getItems(),d=0;d<c.length;d++)this.pushBaseItem(c[d]);this.pushState(a);this.closure(a,b);return a}return c};akra.parser.Parser.prototype.hasEmptyRule=function(a){if(this.isTerminal(a))return!1;var b=this._pRulesDMap,c;for(c in b[a])if(0===b[a][c].right.length)return!0;return!1};
akra.parser.Parser.prototype.pushInSyntaxTable=function(a,b,c){var d=this._pSyntaxTable;d[a]||(d[a]={});akra.isDef(d[a][b])&&this._error(akra.parser.PARSER_GRAMMAR_ADD_OPERATION,{stateIndex:a,grammarSymbol:this.convertGrammarSymbol(b),oldOperation:this._pSyntaxTable[a][b],newOperation:c});d[a][b]=c};
akra.parser.Parser.prototype.addStateLink=function(a,b,c){a.addNextState(c,b)||this._error(akra.parser.PARSER_GRAMMAR_ADD_STATE_LINK,{stateIndex:a.getIndex(),oldNextStateIndex:a.getNextStateBySymbol(c),newNextStateIndex:b.getIndex(),grammarSymbol:this.convertGrammarSymbol(c)})};
akra.parser.Parser.prototype.firstTerminal=function(a){if(this.isTerminal(a))return null;if(akra.isDef(this._pFirstTerminalsDMap[a]))return this._pFirstTerminalsDMap[a];var b,c,d,e=0;b=0;var f=null,g=this._pRulesDMap[a];c={};var k,m,n;k=this._pFirstTerminalsDMap[a]={};this.hasEmptyRule(a)&&(k[akra.parser.T_EMPTY]=!0);if(akra.isNull(g))return k;for(var p=Object.keys(g),e=0;e<p.length;++e){b=p[e];n=!1;m=g[b].right;for(b=0;b<m.length;b++){if(m[b]===a){if(k[akra.parser.T_EMPTY])continue;n=!0;break}c=
this.firstTerminal(m[b]);if(akra.isNull(c))k[m[b]]=!0;else for(d=Object.keys(c),f=0;f<d.length;++f)c=d[f],k[c]=!0;if(!this.hasEmptyRule(m[b])){n=!0;break}}n||(k[akra.parser.T_EMPTY]=!0)}return k};
akra.parser.Parser.prototype.followTerminal=function(a){if(akra.isDef(this._pFollowTerminalsDMap[a]))return this._pFollowTerminalsDMap[a];var b=0,c=0,d=0,e=0,f=0,g=this._pRulesDMap,k,m,n,p,h,l,q,r,s;l=this._pFollowTerminalsDMap[a]={};if(akra.isNull(g))return l;k=Object.keys(g);for(b=0;b<k.length;b++)if(s=k[b],!akra.isNull(g[s]))for(m=Object.keys(g[s]),c=0;c<m.length;c++)for(n=g[s][void 0],q=n.right,d=0;d<q.length;d++)if(q[d]===a)if(d===q.length-1)for(p=this.followTerminal(n.left),h=Object.keys(p),
f=0;f<h.length;b++)l[h[f]]=!0;else{r=!1;for(e=d+1;e<q.length;e++){p=this.firstTerminal(q[e]);if(akra.isNull(p)){r=l[q[e]]=!0;break}else for(h=Object.keys(p),f=0;f<h.length;b++)l[h[f]]=!0;if(!p[akra.parser.T_EMPTY]){r=!0;break}}if(!r)for(p=this.followTerminal(n.left),h=Object.keys(p),f=0;f<h.length;b++)l[h[f]]=!0}return l};
akra.parser.Parser.prototype.firstTerminalForSet=function(a,b){for(var c=0,d=0,e={},f,g,k,c=0;c<a.length;c++){d=this.firstTerminal(a[c]);if(akra.isNull(d))return e[a[c]]=!0,e;f=!1;g=Object.keys(d);for(d=0;d<g.length;d++)k=g[d],k===akra.parser.T_EMPTY?f=!0:e[k]=!0;if(!f)return e}if(!akra.isNull(b))for(g=Object.keys(b),d=0;d<g.length;d++)e[g[d]]=!0;return e};
akra.parser.Parser.prototype.generateRules=function(a){a=a.split(/\r?\n/);var b,c,d=!1;this._pRulesDMap={};this._pAdditionalFuncInfoList=[];this._pRuleCreationModeMap={};this._pGrammarSymbols={};for(var e=0,f=0,g=akra.bf.testAll(this._eParseMode,akra.parser.EParseMode.k_AllNode),k=akra.bf.testAll(this._eParseMode,akra.parser.EParseMode.k_Negate),m=akra.bf.testAll(this._eParseMode,akra.parser.EParseMode.k_Add),n=this._pRuleCreationModeMap,p,e=0;e<a.length;e++)if(""!==a[e]&&"\r"!==a[e])if(b=a[e].split(/\s* \s*/),
d)(3===b.length||4===b.length&&""===b[3])&&('"'===b[2][0]||"'"===b[2][0])&&3<b[2].length&&(b[2][0]!==b[2][b[2].length-1]&&this._error(akra.parser.PARSER_GRAMMAR_UNEXPECTED_SYMBOL,{unexpectedSymbol:b[2][b[2].length-1],expectedSymbol:b[2][0],grammarLine:e}),b[2]=b[2].slice(1,b[2].length-1),c=b[2][0],p="_"===c||"a"<=c&&"z">=c||"A"<=c&&"Z">=c?this._pLexer.addKeyword(b[2],b[0]):this._pLexer.addPunctuator(b[2],b[0]),this._pGrammarSymbols[p]=b[2]);else if(b[0]===akra.parser.LEXER_RULES)d=!0;else{!1===akra.isDef(this._pRulesDMap[b[0]])&&
(this._pRulesDMap[b[0]]={});c={left:b[0],right:[],index:0};this._pSymbolMap[b[0]]=!0;this._pGrammarSymbols[b[0]]=b[0];g?n[b[0]]=akra.parser.ENodeCreateMode.k_Default:k&&!akra.isDef(n[b[0]])?n[b[0]]=akra.parser.ENodeCreateMode.k_Default:m&&!akra.isDef(n[b[0]])&&(n[b[0]]=akra.parser.ENodeCreateMode.k_Not);for(f=2;f<b.length;f++)""!==b[f]&&(b[f]===akra.parser.FLAG_RULE_CREATE_NODE?m&&(n[b[0]]=akra.parser.ENodeCreateMode.k_Necessary):b[f]===akra.parser.FLAG_RULE_NOT_CREATE_NODE?k&&!g&&(n[b[0]]=akra.parser.ENodeCreateMode.k_Not):
b[f]===akra.parser.FLAG_RULE_FUNCTION?(b[f+1]&&0!==b[f+1].length||this._error(akra.parser.PARSER_GRAMMAR_BAD_ADDITIONAL_FUNC_NAME,{grammarLine:e}),this._pAdditionalFuncInfoList.push({name:b[f+1],position:c.right.length,rule:c}),f++):"'"===b[f][0]||'"'===b[f][0]?(3!==b[f].length&&this._error(akra.parser.PARSER_GRAMMAR_BAD_KEYWORD,{badKeyword:b[f],grammarLine:e}),b[f][0]!==b[f][2]&&this._error(akra.parser.PARSER_GRAMMAR_UNEXPECTED_SYMBOL,{unexpectedSymbol:b[f][2],expectedSymbol:b[f][0],grammarLine:e}),
p=this._pLexer.addPunctuator(b[f][1]),c.right.push(p),this._pSymbolMap[p]=!0):(c.right.push(b[f]),this._pSymbolMap[b[f]]=!0));c.index=this._nRules;this._pRulesDMap[b[0]][c.index]=c;this._nRules+=1}};
akra.parser.Parser.prototype.generateFunctionByStateMap=function(){if(!akra.isNull(this._pAdditionalFunctionsMap)){var a=this._pStateList,b=this._pAdditionalFuncInfoList,c,d;c=0;for(var e,f,g=0,k=0,m={},m=this._pAdidtionalFunctByStateDMap={},g=0;g<b.length;g++)if(c=b[g],e=this._pAdditionalFunctionsMap[c.name],akra.isDef(e))for(d=c.rule,c=c.position,f=d.right[c-1],k=0;k<a.length;k++)a[k].hasRule(d,c)&&(akra.isDef(m[a[k].getIndex()])||(m[a[k].getIndex()]={}),m[a[k].getIndex()][f]=e)}};
akra.parser.Parser.prototype.generateFirstState=function(a){a===akra.parser.EParserType.k_LR0?this.generateFirstState_LR0():this.generateFirstState_LR()};akra.parser.Parser.prototype.generateFirstState_LR0=function(){var a=new akra.parser.State,b=new akra.parser.Item(this._pRulesDMap[akra.parser.START_SYMBOL][0],0);this.pushBaseItem(b);a.push(b);this.closure_LR0(a);this.pushState(a)};
akra.parser.Parser.prototype.generateFirstState_LR=function(){var a=new akra.parser.State,b={};b[akra.parser.END_SYMBOL]=!0;a.push(new akra.parser.Item(this._pRulesDMap[akra.parser.START_SYMBOL][0],0,b));this.closure_LR(a);this.pushState(a)};akra.parser.Parser.prototype.closure=function(a,b){return b===akra.parser.EParserType.k_LR0?this.closure_LR0(a):this.closure_LR(a)};
akra.parser.Parser.prototype.closure_LR0=function(a){for(var b=a.getItems(),c=0,d=0,e,f,c=0;c<b.length;c++)if(e=b[c].mark(),e!==akra.parser.END_POSITION&&!this.isTerminal(e))for(f=Object.keys(this._pRulesDMap[e]),d=0;d<f.length;d++)a.tryPush_LR0(this._pRulesDMap[e][f[d]],0);return a};
akra.parser.Parser.prototype.closure_LR=function(a){for(var b=a.getItems(),c=0,d=0,e=0,f,g,k=!1,m;;){if(c===b.length){if(!k)break;c=0;k=!1}f=b[c].mark();if(f!==akra.parser.END_POSITION&&!this.isTerminal(f))for(g=b[c].getRule().right.slice(b[c].getPosition()+1),d=this.firstTerminalForSet(g,b[c].getExpectedSymbols()),g=Object.keys(this._pRulesDMap[f]),m=Object.keys(d),d=0;d<g.length;d++)for(e=0;e<m.length;e++)a.tryPush_LR(this._pRulesDMap[f][g[d]],0,m[e])&&(k=!0);c++}return a};
akra.parser.Parser.prototype.nexeState=function(a,b,c){return c===akra.parser.EParserType.k_LR0?this.nextState_LR0(a,b):this.nextState_LR(a,b)};akra.parser.Parser.prototype.nextState_LR0=function(a,b){for(var c=a.getItems(),d=0,e=new akra.parser.State,d=0;d<c.length;d++)b===c[d].mark()&&e.push(new akra.parser.Item(c[d].getRule(),c[d].getPosition()+1));return e};
akra.parser.Parser.prototype.nextState_LR=function(a,b){for(var c=a.getItems(),d=0,e=new akra.parser.State,d=0;d<c.length;d++)b===c[d].mark()&&e.push(new akra.parser.Item(c[d].getRule(),c[d].getPosition()+1,c[d].getExpectedSymbols()));return e};akra.parser.Parser.prototype.deleteNotBaseItems=function(){for(var a=0,a=0;a<this._pStateList.length;a++)this._pStateList[a].deleteNotBase()};
akra.parser.Parser.prototype.closureForItem=function(a,b){var c;c=""+(a.index+"_"+b);var d=this._pStatesTempMap[c];if(!akra.isDef(d)){var e={};e[akra.parser.UNUSED_SYMBOL]=!0;d=new akra.parser.State;d.push(new akra.parser.Item(a,b,e));this.closure_LR(d);this._pStatesTempMap[c]=d}return d};akra.parser.Parser.prototype.addLinkExpected=function(a,b){var c=this._pExpectedExtensionDMap,d=a.getIndex();akra.isDef(c[d])||(c[d]={});c[d][b.getIndex()]=!0};
akra.parser.Parser.prototype.determineExpected=function(a,b){var c=a.getNextStateBySymbol(b);if(!akra.isNull(c))for(var d=c.getItems(),e=a.getItems(),f,g=0,k=0,m=null,n=a.getNumBaseItems(),p=c.getNumBaseItems(),g=0;g<n;g++)for(c=this.closureForItem(e[g].getRule(),e[g].getPosition()),k=0;k<p;k++)if(f=c.hasChildItem(d[k]))for(m in f=f.getExpectedSymbols(),f)m===akra.parser.UNUSED_SYMBOL?this.addLinkExpected(e[g],d[k]):d[k].addExpected(m)};
akra.parser.Parser.prototype.generateLinksExpected=function(){for(var a=0,b=0,c=this._pStateList,d,a=0;a<c.length;a++)for(d=Object.keys(this._pSymbolMap),b=0;b<d.length;b++)this.determineExpected(c[a],d[b])};
akra.parser.Parser.prototype.expandExpected=function(){var a=this._pBaseItemList,b=this._pExpectedExtensionDMap,c=0,d=0,e=0,f=null,g=!1;a[0].addExpected(akra.parser.END_SYMBOL);for(a[0].setIsNewExpected(!0);;){if(c===a.length){if(!g)break;g=!1;c=0}if(a[c].getIsNewExpected()&&akra.isDefAndNotNull(b[c])&&akra.isDefAndNotNull(a[c].getExpectedSymbols()))for(var k=Object.keys(a[c].getExpectedSymbols()),m=Object.keys(b[c]),d=0;d<k.length;d++)for(f=k[d],e=0;e<m.length;e++)a[m[e]].addExpected(f)&&(g=!0);
a[c].setIsNewExpected(!1);c++}};akra.parser.Parser.prototype.generateStates=function(a){a===akra.parser.EParserType.k_LR0?this.generateStates_LR0():a===akra.parser.EParserType.k_LR1?this.generateStates_LR():a===akra.parser.EParserType.k_LALR&&this.generateStates_LALR()};
akra.parser.Parser.prototype.generateStates_LR0=function(){this.generateFirstState_LR0();for(var a=0,b=0,c=this._pStateList,d=null,e,f=Object.keys(this._pSymbolMap),a=0;a<c.length;a++)for(b=0;b<f.length;b++)d=f[b],e=this.nextState_LR0(c[a],d),e.isEmpty()||(e=this.tryAddState(e,akra.parser.EParserType.k_LR0),this.addStateLink(c[a],e,d))};
akra.parser.Parser.prototype.generateStates_LR=function(){this._pFirstTerminalsDMap={};this.generateFirstState_LR();for(var a=0,b=0,c=this._pStateList,d=null,e,f=Object.keys(this._pSymbolMap),a=0;a<c.length;a++)for(b=0;b<f.length;b++)d=f[b],e=this.nextState_LR(c[a],d),e.isEmpty()||(e=this.tryAddState(e,akra.parser.EParserType.k_LR1),this.addStateLink(c[a],e,d))};
akra.parser.Parser.prototype.generateStates_LALR=function(){this._pStatesTempMap={};this._pBaseItemList=[];this._pExpectedExtensionDMap={};this._pFirstTerminalsDMap={};this.generateStates_LR0();this.deleteNotBaseItems();this.generateLinksExpected();this.expandExpected();for(var a=0,b=this._pStateList,a=0;a<b.length;a++)this.closure_LR(b[a])};akra.parser.Parser.prototype.calcBaseItem=function(){for(var a=0,b=0,b=0;b<this._pStateList.length;b++)a+=this._pStateList[b].getNumBaseItems();return a};
akra.parser.Parser.prototype.printExpectedTable=function(){for(var a=0,b=0,c="",d=Object.keys(this._pExpectedExtensionDMap),a=0;a<d.length;a++){for(var c=c+("State "+this._pBaseItemList[d[a]].getState().getIndex()+":   "),c=c+(this._pBaseItemList[d[a]].toString()+"  |-----\x3e\n"),e=Object.keys(this._pExpectedExtensionDMap[d[a]]),b=0;b<e.length;b++)c+="\t\t\t\t\tState "+this._pBaseItemList[e[b]].getState().getIndex()+":   ",c+=this._pBaseItemList[e[b]].toString()+"\n";c+="\n"}return c};
akra.parser.Parser.prototype.addReducing=function(a){for(var b=0,c=0,d=a.getItems(),b=0;b<d.length;b++)if(d[b].mark()===akra.parser.END_POSITION)if(d[b].getRule().left===akra.parser.START_SYMBOL)this.pushInSyntaxTable(a.getIndex(),akra.parser.END_SYMBOL,this._pSuccessOperation);else for(var c=d[b].getExpectedSymbols(),e=Object.keys(c),c=0;c<e.length;c++)this.pushInSyntaxTable(a.getIndex(),e[c],this._pReduceOperationsMap[d[b].getRule().index])};
akra.parser.Parser.prototype.addShift=function(a){for(var b=0,c=a.getNextStates(),d=Object.keys(c),b=0;b<d.length;b++){var e=d[b];this.pushInSyntaxTable(a.getIndex(),e,this._pShiftOperationsMap[c[e].getIndex()])}};
akra.parser.Parser.prototype.buildSyntaxTable=function(){var a=this._pStateList=[],b;this.generateStates(this._eType);this._pSyntaxTable={};this._pReduceOperationsMap={};this._pShiftOperationsMap={};this._pSuccessOperation={type:akra.parser.EOperationType.k_Success};for(var c=0,c=c=b=0;c<a.length;c++)this._pShiftOperationsMap[a[c].getIndex()]={type:akra.parser.EOperationType.k_Shift,index:a[c].getIndex()};var d=Object.keys(this._pRulesDMap);for(b=0;b<d.length;b++)for(var e=Object.keys(this._pRulesDMap[d[b]]),
c=0;c<e.length;c++){var f=e[c];this._pReduceOperationsMap[f]={type:akra.parser.EOperationType.k_Reduce,rule:this._pRulesDMap[d[b]][f]}}for(c=0;c<a.length;c++)b=a[c],this.addReducing(b),this.addShift(b)};akra.parser.Parser.prototype.readToken=function(){return this._pLexer.getNextToken()};
akra.parser.Parser.prototype.operationAdditionalAction=function(a,b){var c=this._pAdidtionalFunctByStateDMap;return!akra.isNull(this._pAdidtionalFunctByStateDMap)&&akra.isDef(c[a])&&akra.isDef(c[a][b])?c[a][b].call(this):akra.parser.EOperationType.k_Ok};
akra.parser.Parser.prototype.resumeParse=function(){try{for(var a=this._pSyntaxTree,b=this._pStack,c=this._pSyntaxTable,d=!1,e=!1,f=!1,g=akra.isNull(this._pToken)?this.readToken():this._pToken,k,m,n,p=0;!d;)if(k=c[b[b.length-1]][g.name],akra.isDef(k))switch(k.type){case akra.parser.EOperationType.k_Success:d=!0;break;case akra.parser.EOperationType.k_Shift:p=k.index;b.push(p);a.addNode(g);n=this.operationAdditionalAction(p,g.name);n===akra.parser.EOperationType.k_Error?d=e=!0:n===akra.parser.EOperationType.k_Pause?
(this._pToken=null,f=d=!0):n===akra.parser.EOperationType.k_Ok&&(g=this.readToken());break;case akra.parser.EOperationType.k_Reduce:m=k.rule.right.length,b.length-=m,p=c[b[b.length-1]][k.rule.left].index,b.push(p),a.reduceByRule(k.rule,this._pRuleCreationModeMap[k.rule.left]),n=this.operationAdditionalAction(p,k.rule.left),n===akra.parser.EOperationType.k_Error?d=e=!0:n===akra.parser.EOperationType.k_Pause&&(this._pToken=g,f=d=!0)}else d=e=!0}catch(h){return this._sFileName="stdin",akra.parser.EParserCode.k_Error}if(f)return akra.parser.EParserCode.k_Pause;
if(e)return this._error(akra.parser.PARSER_SYNTAX_ERROR,g),akra.isDef(this._fnFinishCallback)&&this._fnFinishCallback.call(this._pCaller,akra.parser.EParserCode.k_Error,this.getParseFileName()),this._sFileName="stdin",akra.parser.EParserCode.k_Error;a.finishTree();akra.isDef(this._fnFinishCallback)&&this._fnFinishCallback.call(this._pCaller,akra.parser.EParserCode.k_Ok,this.getParseFileName());this._sFileName="stdin";return akra.parser.EParserCode.k_Ok};
akra.parser.Parser.prototype.statesToString=function(a){"undefined"===typeof a&&(a=!0);if(!akra.isDef(this._pStateList))return null;for(var b="",c=0,c=0;c<this._pStateList.length;c++)b+=this._pStateList[c].toString(a),b+=" ";return b};
akra.parser.Parser.prototype.operationToString=function(a){var b=null;switch(a.type){case akra.parser.EOperationType.k_Shift:b="SHIFT to state "+a.index.toString();break;case akra.parser.EOperationType.k_Reduce:b="REDUCE by rule { "+this.ruleToString(a.rule)+" }";break;case akra.parser.EOperationType.k_Success:b="SUCCESS"}return b};akra.parser.Parser.prototype.ruleToString=function(a){return a.left+" : "+a.right.join(" ")};
akra.parser.Parser.prototype.convertGrammarSymbol=function(a){return this.isTerminal(a)?this._pLexer.getTerminalValueByName(a):a};